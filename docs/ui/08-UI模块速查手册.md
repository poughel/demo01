# DataSophon UI 模块 - 速查手册

## 一、快速开始

### 1.1 安装依赖

```bash
# 使用 npm
npm install

# 使用 yarn (推荐)
yarn install
```

### 1.2 启动开发服务器

```bash
# npm
npm run serve

# yarn
yarn serve

# 访问 http://localhost:8080
```

### 1.3 生产构建

```bash
# npm
npm run build

# yarn
yarn build

# 输出目录: dist/
```

## 二、常用 API 速查

### 2.1 HTTP 请求

#### GET 请求
```javascript
// 方式 1: 直接使用
this.$axiosGet('/api/cluster/list', {
  page: 1,
  size: 10
}).then(data => {
  console.log(data)
})

// 方式 2: async/await
async loadData() {
  const data = await this.$axiosGet(api.getClusterList, {page: 1})
  this.list = data
}
```

#### POST 请求 (JSON)
```javascript
this.$axiosJsonPost('/api/cluster/save', {
  clusterName: 'test',
  clusterCode: 'TEST'
}).then(() => {
  this.$message.success('保存成功')
})
```

#### POST 请求 (FormData)
```javascript
this.$axiosPost('/api/cluster/update', {
  id: 1,
  name: 'test'
})
```

#### 文件上传
```javascript
const formData = new FormData()
formData.append('file', file)
formData.append('clusterId', clusterId)

this.$axiosPostUpload('/api/upload', formData)
  .then(() => {
    this.$message.success('上传成功')
  })
```

### 2.2 API 接口导入

```javascript
// 导入集群 API
import clusterApi from '@/api/httpApi/cluster'

// 使用
this.$axiosGet(clusterApi.getColonyList)
```

### 2.3 常用 API 列表

#### 集群管理
```javascript
import clusterApi from '@/api/httpApi/cluster'

clusterApi.getColonyList       // 获取集群列表
clusterApi.saveColony          // 保存集群
clusterApi.updateColony        // 更新集群
clusterApi.deleteColony        // 删除集群
clusterApi.runningClusterList  // 运行中集群列表
```

#### 主机管理
```javascript
import hostApi from '@/api/httpApi/host'

hostApi.getHostList            // 获取主机列表
hostApi.addHost                // 添加主机
hostApi.deleteHost             // 删除主机
```

#### 服务管理
```javascript
import servicesApi from '@/api/httpApi/services'

servicesApi.getServiceList     // 获取服务列表
servicesApi.startService       // 启动服务
servicesApi.stopService        // 停止服务
servicesApi.restartService     // 重启服务
```

## 三、路由速查

### 3.1 路由导航

#### 声明式导航
```vue
<!-- 路径导航 -->
<router-link to="/overview">总览</router-link>

<!-- 命名路由 -->
<router-link :to="{name: 'overview'}">总览</router-link>

<!-- 带参数 -->
<router-link :to="{name: 'serviceDetail', params: {id: 1}}">
  服务详情
</router-link>

<!-- 带查询参数 -->
<router-link :to="{path: '/overview', query: {clusterId: 1}}">
  总览
</router-link>
```

#### 编程式导航
```javascript
// 路径跳转
this.$router.push('/overview')

// 命名路由
this.$router.push({name: 'overview'})

// 带参数
this.$router.push({
  name: 'serviceDetail',
  params: {id: 1}
})

// 带查询参数
this.$router.push({
  path: '/overview',
  query: {clusterId: 1}
})

// 替换当前路由（不产生历史记录）
this.$router.replace({path: '/overview'})

// 前进/后退
this.$router.go(-1)  // 后退
this.$router.go(1)   // 前进
```

### 3.2 路由参数获取

```javascript
// 路由参数
this.$route.params.id

// 查询参数
this.$route.query.clusterId

// 完整路径
this.$route.fullPath

// 路由名称
this.$route.name
```

### 3.3 路由守卫

```javascript
// 组件内守卫
export default {
  beforeRouteEnter(to, from, next) {
    // 进入前
    next()
  },
  beforeRouteUpdate(to, from, next) {
    // 路由更新
    next()
  },
  beforeRouteLeave(to, from, next) {
    // 离开前
    next()
  }
}
```

## 四、组件速查

### 4.1 常用组件

#### StandardTable - 标准表格
```vue
<template>
  <standard-table
    :columns="columns"
    :data-source="dataSource"
    :loading="loading"
    :pagination="pagination"
    @change="handleChange"
  >
    <template slot="action" slot-scope="{record}">
      <a @click="handleEdit(record)">编辑</a>
      <a-divider type="vertical" />
      <a @click="handleDelete(record)">删除</a>
    </template>
  </standard-table>
</template>

<script>
export default {
  data() {
    return {
      columns: [
        {title: '名称', dataIndex: 'name'},
        {title: '状态', dataIndex: 'status'},
        {title: '操作', scopedSlots: {customRender: 'action'}}
      ],
      dataSource: [],
      loading: false,
      pagination: {
        current: 1,
        pageSize: 10,
        total: 0
      }
    }
  }
}
</script>
```

#### ChartCard - 图表卡片
```vue
<template>
  <chart-card
    title="集群数量"
    :total="clusterCount"
    icon="cluster"
    color="#1890ff"
  >
    <mini-area :data="chartData" color="#1890ff" />
  </chart-card>
</template>
```

#### PageHeader - 页面头部
```vue
<template>
  <page-header
    title="集群管理"
    sub-title="管理大数据集群"
  >
    <template slot="extra">
      <a-button type="primary">创建集群</a-button>
    </template>
  </page-header>
</template>
```

### 4.2 Ant Design Vue 组件

```vue
<!-- 按钮 -->
<a-button type="primary">主要按钮</a-button>
<a-button>默认按钮</a-button>
<a-button type="dashed">虚线按钮</a-button>
<a-button type="link">链接按钮</a-button>

<!-- 输入框 -->
<a-input v-model="value" placeholder="请输入" />
<a-input-password v-model="password" placeholder="请输入密码" />
<a-input-search placeholder="搜索" @search="handleSearch" />

<!-- 选择框 -->
<a-select v-model="value" placeholder="请选择">
  <a-select-option value="1">选项1</a-select-option>
  <a-select-option value="2">选项2</a-select-option>
</a-select>

<!-- 日期选择 -->
<a-date-picker v-model="date" />
<a-range-picker v-model="dateRange" />

<!-- 弹窗 -->
<a-modal
  title="标题"
  :visible="visible"
  @ok="handleOk"
  @cancel="handleCancel"
>
  内容
</a-modal>

<!-- 抽屉 -->
<a-drawer
  title="标题"
  :visible="visible"
  @close="handleClose"
>
  内容
</a-drawer>

<!-- 消息提示 -->
this.$message.success('成功')
this.$message.error('失败')
this.$message.warning('警告')
this.$message.info('信息')

<!-- 通知 -->
this.$notification.success({
  message: '成功',
  description: '操作成功'
})

<!-- 确认框 -->
this.$confirm({
  title: '确认删除?',
  content: '删除后无法恢复',
  onOk: () => {
    // 确认操作
  }
})
```

## 五、状态管理速查

### 5.1 Vuex 使用

#### 读取状态
```javascript
// 方式 1: 直接访问
this.$store.state.account.user

// 方式 2: Getters
this.$store.getters['account/user']

// 方式 3: mapState
import {mapState} from 'vuex'

computed: {
  ...mapState('account', ['user', 'permissions'])
}

// 方式 4: mapGetters
import {mapGetters} from 'vuex'

computed: {
  ...mapGetters('account', ['user', 'permissions'])
}
```

#### 修改状态
```javascript
// 方式 1: 直接调用 commit
this.$store.commit('account/setUser', user)

// 方式 2: mapMutations
import {mapMutations} from 'vuex'

methods: {
  ...mapMutations('account', ['setUser']),
  
  updateUser() {
    this.setUser(newUser)
  }
}
```

#### 调用 Actions
```javascript
// 方式 1: 直接调用 dispatch
this.$store.dispatch('account/login', {username, password})

// 方式 2: mapActions
import {mapActions} from 'vuex'

methods: {
  ...mapActions('account', ['login', 'logout']),
  
  async handleLogin() {
    await this.login({username, password})
  }
}
```

### 5.2 常用状态

```javascript
// 用户信息
this.$store.state.account.user

// 用户权限
this.$store.state.account.permissions

// 用户角色
this.$store.state.account.roles

// 当前集群
this.$store.state.setting.clusterId

// 菜单数据
this.$store.state.setting.menuData

// 主题
this.$store.state.setting.theme

// 语言
this.$store.state.setting.lang
```

## 六、工具函数速查

### 6.1 格式化

```javascript
import {formatDate, formatFileSize, formatNumber} from '@/utils/formatter'

// 日期格式化
formatDate(new Date())                    // 2025-11-16 10:30:00
formatDate(timestamp, 'YYYY-MM-DD')       // 2025-11-16

// 文件大小格式化
formatFileSize(1024)                      // 1.00 KB
formatFileSize(1048576)                   // 1.00 MB

// 数字格式化（千分位）
formatNumber(1000000)                     // 1,000,000
```

### 6.2 工具函数

```javascript
import {debounce, throttle, deepClone} from '@/utils/util'

// 防抖
const debouncedSearch = debounce(function(keyword) {
  this.search(keyword)
}, 500)

// 节流
const throttledScroll = throttle(function() {
  this.loadMore()
}, 1000)

// 深拷贝
const copy = deepClone(originalObject)
```

### 6.3 权限检查

```javascript
import {hasAuthority} from '@/utils/authority-utils'

// 检查权限
const canEdit = hasAuthority(
  {meta: {authority: 'cluster:edit'}},
  permissions,
  roles
)

// 在组件中使用
computed: {
  canEdit() {
    return hasAuthority(
      {meta: {authority: 'cluster:edit'}},
      this.$store.getters['account/permissions'],
      this.$store.getters['account/roles']
    )
  }
}
```

## 七、表单速查

### 7.1 表单基础

```vue
<template>
  <a-form :form="form" @submit="handleSubmit">
    <a-form-item label="集群名称">
      <a-input
        v-decorator="[
          'name',
          {
            rules: [
              {required: true, message: '请输入集群名称'},
              {max: 50, message: '不能超过50个字符'}
            ]
          }
        ]"
        placeholder="请输入集群名称"
      />
    </a-form-item>
    
    <a-form-item>
      <a-button type="primary" html-type="submit" :loading="loading">
        提交
      </a-button>
    </a-form-item>
  </a-form>
</template>

<script>
export default {
  data() {
    return {
      form: this.$form.createForm(this),
      loading: false
    }
  },
  methods: {
    handleSubmit(e) {
      e.preventDefault()
      this.form.validateFields((err, values) => {
        if (!err) {
          this.submit(values)
        }
      })
    },
    async submit(values) {
      this.loading = true
      try {
        await this.$axiosJsonPost(api.save, values)
        this.$message.success('保存成功')
      } finally {
        this.loading = false
      }
    }
  }
}
</script>
```

### 7.2 表单验证规则

```javascript
{
  // 必填
  required: true,
  message: '此字段为必填项'
}

{
  // 最小长度
  min: 6,
  message: '不能少于6个字符'
}

{
  // 最大长度
  max: 50,
  message: '不能超过50个字符'
}

{
  // 正则验证
  pattern: /^[a-zA-Z0-9_]+$/,
  message: '只能包含字母、数字和下划线'
}

{
  // 自定义验证
  validator: (rule, value, callback) => {
    if (value && value.length < 6) {
      callback('密码不能少于6位')
    } else {
      callback()
    }
  }
}
```

## 八、常见问题速查

### 8.1 路由相关

#### 问题：路由跳转后页面不刷新
```javascript
// 解决方案 1: 监听路由
watch: {
  '$route'(to, from) {
    this.loadData()
  }
}

// 解决方案 2: 使用 key
<router-view :key="$route.fullPath" />

// 解决方案 3: beforeRouteUpdate
beforeRouteUpdate(to, from, next) {
  this.loadData()
  next()
}
```

#### 问题：路由参数丢失
```javascript
// ❌ 错误：使用 path + params
this.$router.push({
  path: '/service',
  params: {id: 1}  // params 会丢失
})

// ✅ 正确：使用 name + params
this.$router.push({
  name: 'service',
  params: {id: 1}
})

// ✅ 或使用 path + query
this.$router.push({
  path: '/service',
  query: {id: 1}
})
```

### 8.2 请求相关

#### 问题：请求被缓存
```javascript
// 解决方案：添加时间戳
this.$axiosGet(api.getList, {
  _t: Date.now()
})
```

#### 问题：跨域问题
```javascript
// vue.config.js
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://localhost:8081',
        changeOrigin: true
      }
    }
  }
}
```

### 8.3 组件相关

#### 问题：父子组件通信
```vue
<!-- 父组件 -->
<template>
  <child-component
    :value="value"
    @input="handleInput"
    @submit="handleSubmit"
  />
</template>

<!-- 子组件 -->
<script>
export default {
  props: ['value'],
  methods: {
    handleChange(val) {
      this.$emit('input', val)
    },
    handleSubmit() {
      this.$emit('submit', this.value)
    }
  }
}
</script>
```

#### 问题：组件样式冲突
```vue
<!-- 使用 scoped -->
<style scoped>
.container {
  /* 只影响当前组件 */
}
</style>

<!-- 深度选择器 -->
<style scoped>
.container >>> .ant-btn {
  /* 影响子组件的样式 */
}

/* 或使用 /deep/ */
.container /deep/ .ant-btn {
  /* 影响子组件的样式 */
}
</style>
```

## 九、开发技巧

### 9.1 调试技巧

```javascript
// 1. 使用 Vue DevTools
// 安装 Vue DevTools 浏览器扩展

// 2. 控制台输出
console.log('变量:', variable)
console.table(array)
console.time('计时器')
console.timeEnd('计时器')

// 3. debugger
methods: {
  handleClick() {
    debugger  // 断点
    // ...
  }
}

// 4. 查看组件实例
mounted() {
  console.log('this:', this)
  console.log('props:', this.$props)
  console.log('data:', this.$data)
}
```

### 9.2 性能优化

```javascript
// 1. 计算属性缓存
computed: {
  filteredList() {
    return this.list.filter(item => item.status === 'active')
  }
}

// 2. 列表 key
<div v-for="item in list" :key="item.id">
  {{ item.name }}
</div>

// 3. v-show vs v-if
<div v-show="visible">频繁切换使用 v-show</div>
<div v-if="isAdmin">条件很少改变使用 v-if</div>

// 4. 组件懒加载
components: {
  ChartCard: () => import('@/components/card/ChartCard')
}

// 5. 路由懒加载
{
  path: '/overview',
  component: () => import('@/pages/overview/index')
}
```

### 9.3 代码规范

```javascript
// 1. 命名规范
// 组件名: PascalCase
ChartCard.vue

// 变量/方法: camelCase
let userName = 'test'
function getUserInfo() {}

// 常量: UPPER_SNAKE_CASE
const API_BASE_URL = '/api'

// 2. 注释规范
/**
 * 获取集群列表
 * @param {Object} params 查询参数
 * @returns {Promise} 集群列表
 */
async function getClusterList(params) {
  // 实现
}

// 3. ESLint
// 运行 ESLint 检查
npm run lint
```

## 十、快速参考

### 10.1 常用快捷键

| 快捷键 | 功能 |
|--------|------|
| F12 | 打开开发者工具 |
| Ctrl + Shift + I | 打开开发者工具 |
| Ctrl + Shift + C | 选择元素 |
| Ctrl + Shift + F | 全局搜索 |
| Ctrl + P | 快速打开文件 |
| Ctrl + ` | 打开终端 |

### 10.2 常用命令

| 命令 | 功能 |
|------|------|
| `npm run serve` | 启动开发服务器 |
| `npm run build` | 生产构建 |
| `npm run lint` | 代码检查 |
| `npm install` | 安装依赖 |
| `npm update` | 更新依赖 |

### 10.3 常用目录

| 目录 | 用途 |
|------|------|
| `src/pages/` | 页面组件 |
| `src/components/` | 通用组件 |
| `src/api/` | API 接口 |
| `src/router/` | 路由配置 |
| `src/utils/` | 工具函数 |
| `src/store/` | 状态管理 |

### 10.4 常用链接

| 资源 | 链接 |
|------|------|
| Vue.js 官方文档 | https://v2.vuejs.org/ |
| Vue Router 文档 | https://router.vuejs.org/ |
| Vuex 文档 | https://vuex.vuejs.org/ |
| Ant Design Vue | https://antdv.com/ |
| Axios 文档 | https://axios-http.com/ |

---

**文档状态**: ✅ 已完成  
**内容**: 快速参考和常用 API  
**最后更新**: 2025-11-16
