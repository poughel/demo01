# DataSophon 目录结构详解

## 一、整体目录结构

```
datasophon/
├── .github/                    # GitHub 配置文件
├── .mvn/                       # Maven wrapper 配置
├── bin/                        # 可执行脚本目录
├── conf/                       # 配置文件目录
│   └── profiles/              # 环境配置文件
├── datasophon-api/            # API 服务模块
├── datasophon-common/         # 公共组件模块
├── datasophon-domain/         # 领域模型模块
├── datasophon-infrastructure/ # 基础设施模块
├── datasophon-init/           # 初始化模块
├── datasophon-service/        # 业务服务模块
├── datasophon-ui/             # 前端 UI 模块
├── datasophon-worker/         # Worker 工作节点模块
├── deploy/                    # 部署相关文件
│   ├── compose/              # Docker Compose 配置
│   └── docker/               # Docker 配置
├── docs/                      # 项目文档
├── jmx/                       # JMX 监控配置
├── scripts/                   # 辅助脚本
├── style/                     # 代码风格配置
├── website/                   # 项目网站
├── pom.xml                    # Maven 父项目配置
└── README.md                  # 项目说明文档
```

## 二、核心模块详解

### 2.1 datasophon-api (API 服务模块)

**模块职责**: 提供 RESTful API 接口，是系统的对外服务入口。

**目录结构**:
```
datasophon-api/
├── src/
│   ├── main/
│   │   ├── java/com/datasophon/api/
│   │   │   ├── configuration/      # 配置类
│   │   │   ├── controller/         # 控制器层
│   │   │   ├── exceptions/         # 异常处理
│   │   │   ├── interceptor/        # 拦截器
│   │   │   ├── migration/          # 数据库迁移
│   │   │   ├── security/           # 安全认证
│   │   │   └── DataSophonApplicationServer.java  # 主启动类
│   │   └── resources/
│   │       ├── meta/               # 服务元数据配置
│   │       │   ├── DDP-1.2.0/     # DDP 1.2.0 版本配置
│   │       │   ├── DDP-1.2.1/     # DDP 1.2.1 版本配置
│   │       │   └── DDP-1.2.2/     # DDP 1.2.2 版本配置
│   │       ├── i18n/              # 国际化资源
│   │       ├── templates/         # 模板文件
│   │       ├── application.yml    # 应用配置
│   │       ├── logback-api.xml   # 日志配置
│   │       └── assembly.xml       # 打包配置
│   └── test/                      # 测试代码
└── pom.xml                        # Maven 配置
```

**关键功能**:
- 集群管理 API (ClusterInfoController)
- 服务管理 API (ClusterServiceInstanceController)
- 主机管理 API (ClusterHostController)
- 用户认证和授权 (LoginController, SecurityConfig)
- 告警管理 API (ClusterAlertGroupController)
- 监控数据接口 (ClusterServiceDashboardController)

### 2.2 datasophon-common (公共组件模块)

**模块职责**: 提供系统通用的工具类、常量定义、枚举类等。

**目录结构**:
```
datasophon-common/
├── src/
│   ├── main/java/com/datasophon/common/
│   │   ├── cache/              # 缓存相关
│   │   ├── command/            # 命令封装
│   │   ├── constants/          # 常量定义
│   │   ├── enums/              # 枚举类型
│   │   ├── model/              # 数据模型
│   │   ├── utils/              # 工具类
│   │   └── ...
│   └── resources/
└── pom.xml
```

**关键组件**:
- 通用工具类 (StringUtils, DateUtils, FileUtils 等)
- 枚举定义 (服务状态、命令类型等)
- 常量定义 (系统常量、配置键等)
- 命令执行封装

### 2.3 datasophon-domain (领域模型模块)

**模块职责**: 定义系统的领域实体、值对象等核心模型。

**目录结构**:
```
datasophon-domain/
├── src/main/java/com/datasophon/domain/
│   ├── entity/                 # 实体类
│   │   ├── ClusterInfo         # 集群信息
│   │   ├── ServiceInstance     # 服务实例
│   │   ├── ServiceRoleInstance # 服务角色实例
│   │   └── ...
│   └── vo/                     # 值对象
└── pom.xml
```

**关键实体**:
- 集群相关 (ClusterInfo, ClusterHost)
- 服务相关 (ServiceInstance, ServiceRoleInstance)
- 用户相关 (UserInfo, RoleInfo)
- 告警相关 (AlertGroup, AlertHistory)

### 2.4 datasophon-infrastructure (基础设施模块)

**模块职责**: 提供数据持久化、缓存、消息队列等基础设施支持。

**目录结构**:
```
datasophon-infrastructure/
├── src/main/java/com/datasophon/infrastructure/
│   ├── mapper/                 # MyBatis Mapper
│   ├── repository/             # 仓储实现
│   └── ...
└── pom.xml
```

**关键组件**:
- MyBatis Mapper 接口
- 数据访问层实现
- 缓存管理

### 2.5 datasophon-service (业务服务模块)

**模块职责**: 实现核心业务逻辑，是系统的业务处理中心。

**目录结构**:
```
datasophon-service/
├── src/main/java/com/datasophon/service/
│   ├── impl/                   # 服务实现类
│   ├── strategy/               # 策略模式实现
│   └── ...
└── pom.xml
```

**核心服务**:
- 集群管理服务
- 服务部署和安装服务
- 监控数据采集服务
- 告警处理服务

### 2.6 datasophon-worker (Worker 工作节点模块)

**模块职责**: 在各个节点上执行具体的部署、启动、停止等操作。

**目录结构**:
```
datasophon-worker/
├── src/
│   ├── main/java/com/datasophon/worker/
│   │   ├── actor/              # Actor 模型实现
│   │   ├── handler/            # 命令处理器
│   │   ├── strategy/           # 执行策略
│   │   └── WorkerApplicationServer.java  # Worker 启动类
│   └── resources/
│       ├── application.yml     # 应用配置
│       └── logback-worker.xml # 日志配置
└── pom.xml
```

**关键功能**:
- 命令执行
- 服务进程管理
- 节点监控数据采集
- 日志收集

### 2.7 datasophon-init (初始化模块)

**模块职责**: 提供系统初始化、数据库初始化等脚本。

**目录结构**:
```
datasophon-init/
├── bin/                        # 初始化脚本
├── config/                     # 配置模板
├── remove/                     # 卸载脚本
├── sbin/                       # 系统脚本
└── sql/                        # SQL 脚本
    └── datasophon.sql         # 数据库初始化脚本
```

**关键文件**:
- 数据库初始化 SQL
- 环境初始化脚本
- 配置文件模板

### 2.8 datasophon-ui (前端 UI 模块)

**模块职责**: 提供 Web 管理界面。

**目录结构**:
```
datasophon-ui/
├── public/                     # 静态资源
├── src/
│   ├── api/                   # API 接口封装
│   ├── assets/                # 资源文件
│   ├── components/            # Vue 组件
│   ├── layouts/               # 页面布局
│   ├── pages/                 # 页面组件
│   ├── router/                # 路由配置
│   ├── store/                 # Vuex 状态管理
│   ├── utils/                 # 工具函数
│   ├── App.vue               # 根组件
│   └── main.js               # 入口文件
├── package.json               # NPM 配置
└── vue.config.js             # Vue CLI 配置
```

**关键页面**:
- 集群管理
- 服务管理
- 主机管理
- 监控大盘
- 告警管理
- 用户管理

## 三、配置文件目录

### 3.1 conf/ 目录
```
conf/
└── profiles/
    └── application-config.yml  # 应用配置文件
```

### 3.2 元数据配置
位于 `datasophon-api/src/main/resources/meta/` 下，包含各个大数据组件的配置定义：
- HDFS、YARN、HBase、Hive、Spark、Flink 等
- 每个组件包含 service_ddl.json 定义文件
- 定义了服务的角色、配置项、依赖关系等

## 四、部署和脚本

### 4.1 bin/ 目录
包含可执行脚本：
- 启动脚本
- 停止脚本
- 重启脚本

### 4.2 deploy/ 目录
包含部署相关配置：
- Docker 镜像构建文件
- Docker Compose 编排文件

### 4.3 scripts/ 目录
包含辅助脚本：
- 代码生成脚本
- 数据迁移脚本
- 工具脚本

## 五、文档和资源

### 5.1 docs/ 目录
包含项目文档，主要是中文文档。

### 5.2 website/ 目录
包含项目官网的静态资源。

### 5.3 jmx/ 目录
包含 JMX 监控的配置文件。

## 六、构建配置

### 6.1 根 pom.xml
Maven 父项目配置，定义了：
- 项目版本
- 依赖版本管理
- 插件配置
- 多模块配置

### 6.2 模块 pom.xml
各个子模块的 Maven 配置文件。

## 七、代码规范

### 7.1 style/ 目录
包含代码风格配置文件：
- Checkstyle 配置
- 代码格式化规则

---

**总文件统计**: 约 984 个源代码文件
**主要编程语言**: Java, JavaScript/Vue, SQL, Shell
**构建工具**: Maven, NPM
